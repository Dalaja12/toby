<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberPet Ultra</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        /* Estilos base */
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #0ff;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="30" viewBox="0 0 24 30"><path fill="%230ff" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><circle fill="%23f00" cx="12" cy="12" r="3"/></svg>'), auto;
            transition: background-color 1s;
        }

        /* Contenedor principal */
        .cyber-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        /* Partículas de fondo */
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* Cara del robot */
        .face {
            position: relative;
            margin-bottom: 40px;
        }

        .eyes-container {
            display: flex;
            gap: 100px;
            margin-bottom: 40px;
        }

        /* Contenedor de ojos */
.eyes-container {
    display: flex;
    gap: 100px;
    margin-bottom: 40px;
}

/* Estructura del ojo */
.eye {
    width: 100px;
    height: 140px;
    background: #0ff;
    border-radius: 50%;
    box-shadow: 0 0 30px #0ff;
    position: relative;
    overflow: hidden;
    animation: blink 4s infinite;
}

/* Pupila */
.pupil {
    position: absolute;
    width: 40px;
    height: 40px;
    background: #000;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.1s linear;
}

/* Reflejos de luz (puntitos blancos) */
.eye::before {
    content: '';
    position: absolute;
    top: 25px;
    left: 30px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    filter: blur(0.5px);
    z-index: 2;
}

.eye::after {
    content: '';
    position: absolute;
    top: 40px;
    left: 50px;
    width: 10px;
    height: 10px;
    background: white;
    border-radius: 50%;
    filter: blur(0.3px);
    z-index: 2;
}

/* Animación de parpadeo */
@keyframes blink {
    0%, 96% { height: 140px; }
    97%, 99% { height: 10px; }
    100% { height: 140px; }
}

/* Modo dormir */
.eye.sleep {
    height: 10px !important;
    animation: none;
    background: #033;
    box-shadow: 0 5px 10px rgba(0,0,0,0.5);
}

.eye.sleep .pupil,
.eye.sleep::before,
.eye.sleep::after {
    opacity: 0;
}
        
/* Boca base */
.mouth {
    width: 200px;
    height: 60px;
    background: #FF0000;
    border-radius: 0 0 100px 100px;
    box-shadow: 0 0 25px #FF0000;
    transition: all 0.3s;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
}

/* DIENTES FELIZ (línea blanca normal) */
.mouth.happy::before {
    content: '';
    position: absolute;
    top: -3px;
    left: 0;
    width: 100%;
    height: 20px;
    background: white;
    border-radius: 3px;
}

/* DIENTES ENOJADO (más grandes) */
.mouth.angry {
    border-radius: 100px 100px 0 0;
}
.mouth.angry::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 0;
    width: 100%;
    height: 15px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
}

/* LENGUA ENOJADO */
.mouth.angry::after {
    content: '';
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 50px;
    background: #FF3366;
    border-radius: 60px 60px 0 0;
    animation: tongueMoveFast 0.3s infinite alternate;
}

/* SORPRENDIDO (solo lengua gigante) */
.mouth.surprised {
    height: 100px;
    border-radius: 60%;
}
.mouth.surprised::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 50px;
    background: #FF3366;
    border-radius: 80px 80px 0 0;
   
}

/* DORMIDO (sin elementos) */
.mouth.sleep {
    width: 120px;
    height: 20px;
    border-radius: 10px;
    background: #666;
    box-shadow: 0 0 15px #666;
}
.mouth.sleep::before,
.mouth.sleep::after {
    display: none;
}

/* Animaciones */
@keyframes tongueMoveFast {
    0% { transform: translateX(-50%) scaleY(0.8); }
    100% { transform: translateX(-50%) scaleY(1.1); }
}

@keyframes tongueMoveSlow {
    0% { transform: translateX(-50%) scaleY(0.7); }
    100% { transform: translateX(-50%) scaleY(1.2); }
}
/* Animación de masticar */
.mouth.eating {
    animation: chew 0.3s infinite alternate;
}

@keyframes chew {
    0% {
        transform: scaleY(1);
        border-radius: 0 0 100px 100px;
    }
    50% {
        transform: scaleY(0.7);
        border-radius: 50px;
    }
    100% {
        transform: scaleY(1.2);
        border-radius: 0 0 80px 80px;
    }
}

/* Para la boca enojada (masticar diferente) */
.mouth.angry.eating {
    animation: angryChew 0.3s infinite alternate;
}

@keyframes angryChew {
    0% {
        transform: scaleY(1) translateY(0);
        border-radius: 100px 100px 0 0;
    }
    100% {
        transform: scaleY(0.8) translateY(10px);
        border-radius: 80px 80px 0 0;
    }
}

/* Para la boca sorprendida (masticar diferente) */
.mouth.surprised.eating {
    animation: surprisedChew 0.4s infinite alternate;
}

@keyframes surprisedChew {
    0% {
        transform: scale(1);
        height: 140px;
    }
    100% {
        transform: scale(0.9);
        height: 120px;
    }
}


        /* Expresiones */
        .mouth.happy {
            border-radius: 0 0 100px 100px;
        }
        .mouth.angry {
            border-radius: 100px 100px 0 0;
            background: #f00;
            box-shadow: 0 0 25px #f00;
        }
        .mouth.sleep {
            width: 120px;
            height: 20px;
            border-radius: 10px;
        }
        .mouth.surprised {
            height: 120px;
            border-radius: 50%;
        }

        /* Panel de estadísticas */
        .stats-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #0ff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 15px #0ff;
            z-index: 10;
        }

        .stat {
            margin-bottom: 10px;
        }

        .stat-label {
            display: inline-block;
            width: 120px;
        }

        .progress-bar {
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #0ff;
            width: 100%;
            transition: width 0.5s;
        }

        /* Controles */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 10;
        }

        button {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #0ff;
            color: #0ff;
            padding: 12px 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        button:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 15px #0ff;
        }

        /* Ventana de comida */
        .food-window {
            position: fixed;
            width: 300px;
            background: rgba(0, 20, 30, 0.9);
            border: 2px solid #0ff;
            border-radius: 10px;
            box-shadow: 0 0 20px #0ff;
            padding: 15px;
            z-index: 100;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .food-window-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #0ff;
        }

        .food-window-title {
            margin: 0;
            color: #0ff;
            font-size: 18px;
        }

        .close-btn {
            background: transparent;
            border: none;
            color: #f00;
            font-size: 20px;
            cursor: pointer;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .food-item {
            font-size: 30px;
            cursor: pointer;
            text-align: center;
            transition: transform 0.2s;
            user-select: none;
        }

        .food-item:hover {
            transform: scale(1.2);
        }

        /* Comida en cursor */
        .food-cursor {
            position: absolute;
            pointer-events: none;
            font-size: 40px;
            z-index: 1000;
            transform: translate(-50%, -50%);
            display: none;
        }

        /* Personalización */
        #customBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
            background: rgba(0,0,0,0.7);
            border: 2px solid var(--main-color, #0ff);
            color: var(--main-color, #0ff);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        #customBtn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 10px var(--main-color, #0ff);
        }
        
        .custom-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 20, 30, 0.9);
            border: 2px solid var(--main-color, #0ff);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 20px var(--main-color, #0ff);
            z-index: 100;
            width: 200px;
            display: none;
        }
        
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
            justify-content: center;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #fff;
            transition: transform 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 0 5px #fff;
        }
        
        /* Buscador mejorado */
        #searchBtn {
            position: fixed;
            top: 20px;
            right: 70px;
            z-index: 50;
            background: rgba(0,0,0,0.7);
            border: 2px solid var(--main-color, #0ff);
            color: var(--main-color, #0ff);
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        #searchBtn:hover {
            background: rgba(0, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .search-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 350px;
            max-height: calc(100vh - 90px);
            background: rgba(0, 20, 30, 0.97);
            border: 2px solid var(--main-color, #0ff);
            border-radius: 15px;
            box-shadow: 0 0 20px var(--main-color, #0ff);
            z-index: 200;
            display: none;
            flex-direction: column;
            overflow: hidden;
            font-family: 'Comic Neue', cursive;
        }
        
        .search-header {
            padding: 15px;
            background: rgba(0, 10, 20, 0.9);
            border-bottom: 1px solid var(--main-color, #0ff);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-title {
            margin: 0;
            color: var(--main-color, #0ff);
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .search-close {
            background: transparent;
            border: none;
            color: var(--main-color, #0ff);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 30, 50, 0.7);
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 15px;
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.4;
            font-size: 0.95em;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: rgba(0, 255, 255, 0.15);
            border: 1px solid var(--main-color, #0ff);
            margin-left: auto;
            color: #fff;
            border-top-right-radius: 5px;
        }
        
        .bot-message {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.5);
            margin-right: auto;
            color: #fff;
            border-top-left-radius: 5px;
        }
        
        
        .input-container {
            display: flex;
            padding: 15px;
            background: rgba(0, 10, 20, 0.9);
            border-top: 1px solid var(--main-color, #0ff);
        }
        
        #userInput {
            flex: 1;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--main-color, #0ff);
            border-radius: 25px;
            color: #fff;
            font-family: 'Comic Neue', cursive;
            font-size: 0.95em;
            outline: none;
        }
        
        #userInput:focus {
            box-shadow: 0 0 10px var(--main-color, #0ff);
        }
        
        .send-btn {
            background: var(--main-color, #0ff);
            border: none;
            color: #000;
            padding: 0 15px;
            margin-left: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .send-btn:hover {
            background: #fff;
            transform: scale(1.05);
        }
        
        .voice-controls {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: rgba(0, 10, 20, 0.9);
            border-top: 1px solid var(--main-color, #0ff);
        }
        
        .voice-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--main-color, #0ff);
            color: var(--main-color, #0ff);
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .voice-btn:hover {
            background: rgba(0, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .voice-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }
        
        .search-result {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 3px solid var(--main-color, #0ff);
        }
        
        .result-title {
            font-weight: bold;
            color: var(--main-color, #0ff);
            margin-bottom: 5px;
        }
        
        .result-link {
            display: block;
            color: #0ff;
            font-size: 0.8em;
            margin-top: 5px;
            word-break: break-all;
        }
        
        .typing-indicator {
            display: inline-block;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: #aaa;
        }
        
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--main-color, #0ff);
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite both;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .eyes-container { gap: 50px; }
            .eye { width: 70px; height: 100px; }
            .pupil { width: 30px; height: 30px; }
            .mouth { width: 150px; height: 45px; }
            .mouth.sleep { width: 90px; }
            .mouth.surprised { height: 90px; }
            button { padding: 10px 15px; }
            .stats-panel { top: 10px; left: 10px; padding: 10px; }
            
            .search-panel {
                width: 300px;
                right: 10px;
            }
            
            #searchBtn {
                right: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .eyes-container { gap: 30px; }
            .eye { width: 50px; height: 70px; }
            .pupil { width: 20px; height: 20px; }
            .mouth { width: 120px; height: 35px; }
            .controls { bottom: 20px; gap: 10px; }
            
            .search-panel {
                width: 280px;
                top: 60px;
                right: 10px;
                max-height: calc(100vh - 70px);
            }
            
            #searchBtn {
                right: 50px;
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .message {
                max-width: 90%;
                font-size: 0.9em;
            }
        }
        .loading-spinner {
    border: 3px solid rgba(0, 255, 255, 0.3);
    border-radius: 50%;
    border-top: 3px solid #0ff;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    margin: 10px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
/* Botón de voz circular */
#voiceCommandBtn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    padding: 0;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.3s;
}

#voiceCommandBtn.listening {
    background: rgba(255, 0, 0, 0.3);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
}

/* Mensaje en el buscador */
.search-panel .listening-message {
    display: none;
    text-align: center;
    color: var(--main-color, #0ff);
    margin: 10px 0;
    font-style: italic;
    animation: blink 1.5s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}
    </style>
</head>
<body>
    <!-- Botón de búsqueda -->
    <button id="searchBtn" title="Buscador CyberPet">🔍</button>

    <!-- Botón de personalización -->
    <button id="customBtn" title="Personalizar">🎨</button>

    <!-- Panel de personalización -->
    <div class="custom-panel" id="customPanel">
        <button class="close-btn" id="closePanel">✖</button>
        <h4>Personalizar Color</h4>
        <div class="color-options">
            <div class="color-option" style="background: #0ff;" onclick="changeColor('#0ff')"></div>
            <div class="color-option" style="background: #f0f;" onclick="changeColor('#f0f')"></div>
            <div class="color-option" style="background: #0f0;" onclick="changeColor('#0f0')"></div>
            <div class="color-option" style="background: #ff0;" onclick="changeColor('#ff0')"></div>
            <div class="color-option" style="background: #f00;" onclick="changeColor('#f00')"></div>
            <div class="color-option" style="background: #00f;" onclick="changeColor('#00f')"></div>
        </div>
    </div>

    <!-- Panel de búsqueda -->
    <div class="search-panel" id="searchPanel">
        <div class="search-header">
            <h3 class="search-title">Buscador CyberPet</h3>
            <button class="search-close" id="searchClose" title="Cerrar">✖</button>
        </div>
        <div class="chat-container" id="chatContainer">
            <div class="bot-message">
                ¡Hola! Soy CyberPet, tu ayudante virtual. Puedes preguntarme sobre cualquier cosa y te buscaré información segura en internet. ¿En qué puedo ayudarte hoy?
            </div>
        </div>
        <div class="input-container">
            <input type="text" id="userInput" placeholder="Escribe tu pregunta...">
            <button onclick="sendQuestion()" class="send-btn" title="Enviar pregunta">➔</button>
        </div>
        <div class="voice-controls">
            <!-- Dentro de <div class="controls"> -->
            <button id="voiceCommandBtn" onclick="startVoiceCommand()" title="Comando de voz">🎤</button>
            <button id="playBtn" class="voice-btn" title="Reproducir" disabled>▶️</button>
            <button id="pauseBtn" class="voice-btn" title="Pausar" disabled>⏸️</button>
            <button id="stopBtn" class="voice-btn" title="Detener" disabled>⏹️</button>
            
        </div>
    </div>

    <!-- Fondo interactivo -->
    <div id="particles-js"></div>

    <!-- Contenedor principal -->
    <div class="cyber-container">
        <!-- Panel de estadísticas -->
        <div class="stats-panel">
            <div class="stat">
                <span class="stat-label">Nivel de energía:</span>
                <span id="energy-level">100%</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="energy-bar"></div>
                </div>
            </div>
            <div class="stat">
                <span class="stat-label">Estado de ánimo:</span>
                <span id="mood-status">Feliz</span>
            </div>
            <div class="stat">
                <span class="stat-label">Comida consumida:</span>
                <span id="food-count">0</span>
            </div>
        </div>

        <!-- Cara del robot -->
        <div class="face">
            <div class="eyes-container">
                <div class="eye" id="leftEye">
                    <div class="pupil" id="leftPupil"></div>
                </div>
                <div class="eye" id="rightEye">
                    <div class="pupil" id="rightPupil"></div>
                </div>
            </div>
            <div class="mouth" id="mouth"></div>
        </div>

        <!-- Controles -->
        <div class="controls">
            <button onclick="changeExpression('happy')">Feliz</button>
            <button onclick="changeExpression('angry')">Enojado</button>
            <button onclick="changeExpression('sleep')">Dormir</button>
            <button onclick="changeExpression('surprised')">Sorprendido</button>
            <button onclick="showFoodWindow()">Alimentar</button>
            <button onclick="takeSelfie()">Selfie</button>
        </div>
    </div>

    <!-- Ventana de comida -->
    <div class="food-window" id="foodWindow">
        <div class="food-window-header">
            <h3 class="food-window-title">Selecciona comida</h3>
            <button class="close-btn" onclick="closeFoodWindow()">✖</button>
        </div>
        <div class="food-grid" id="foodGrid">
            <!-- Los emojis se agregarán con JavaScript -->
        </div>
    </div>

    <!-- Comida en cursor -->
    <div class="food-cursor" id="foodCursor"></div>

    <script>
        // Variables de estado
        let energy = 100;
        let foodConsumed = 0;
        let currentMood = 'happy';
        const foods = ['🍎', '🍕', '🍔', '🍟', '🍦', '🍩', '🍪', '🍜', '🍗', '🍉', '', '🥪'];
        let isNightMode = false;
        let isSleeping = false;
        let sleepInterval;
        let selectedFood = null;
        let isDraggingFood = false;

        // Inicializar partículas
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#0ff" },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 150, color: "#0ff", opacity: 0.4, width: 1 },
                move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" }
                }
            }
        });

        // Modo nocturno automático
        function checkNightMode() {
            const hour = new Date().getHours();
            isNightMode = hour > 18 || hour < 6;
            document.body.style.backgroundColor = isNightMode ? '#0a0a20' : '#000';
        }
        checkNightMode();
        setInterval(checkNightMode, 60000); // Revisar cada minuto

        // Ojos que siguen el cursor
        document.addEventListener('mousemove', (e) => {
            // Mover comida con cursor si está seleccionada
            if (isDraggingFood) {
                const foodCursor = document.getElementById('foodCursor');
                foodCursor.style.left = e.clientX + 'px';
                foodCursor.style.top = e.clientY + 'px';
                
                // Detectar si está sobre la boca
                const mouth = document.getElementById('mouth');
                const mouthRect = mouth.getBoundingClientRect();
                
                if (
                    e.clientX > mouthRect.left && 
                    e.clientX < mouthRect.right &&
                    e.clientY > mouthRect.top && 
                    e.clientY < mouthRect.bottom
                ) {
                    feedPet(selectedFood);
                    stopFoodDrag();
                    return;
                }
            }
            
            if (isSleeping) return;
            
            const leftPupil = document.getElementById('leftPupil');
            const rightPupil = document.getElementById('rightPupil');
            const eyes = document.querySelectorAll('.eye');

            eyes.forEach((eye, index) => {
                const rect = eye.getBoundingClientRect();
                const eyeX = rect.left + rect.width / 2;
                const eyeY = rect.top + rect.height / 2;
                const angle = Math.atan2(e.clientY - eyeY, e.clientX - eyeX);
                const distance = window.innerWidth < 768 ? 10 : 15;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;

                if (index === 0) {
                    leftPupil.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                } else {
                    rightPupil.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                }
            });
        });

        // Cambiar expresión
        function changeExpression(emotion) {
            const mouth = document.getElementById('mouth');
            mouth.className = 'mouth ' + emotion;
            currentMood = emotion;
            document.getElementById('mood-status').textContent = 
                emotion === 'happy' ? 'Feliz' :
                emotion === 'angry' ? 'Enojado' :
                emotion === 'sleep' ? 'Dormido' : 'Sorprendido';

            // Manejar estado de sueño
            if (emotion === 'sleep') {
                startSleeping();
            } else {
                stopSleeping();
            }
        }

        // Emociones aleatorias
        setInterval(() => {
            if (isSleeping) return;
            
            if (Math.random() > 0.7) { // 30% de probabilidad de cambiar
                const emotions = ['happy', 'angry', 'sleep', 'surprised'];
                const newEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                changeExpression(newEmotion);
            }
        }, 30000);

        // Mostrar ventana de comida
        function showFoodWindow() {
            if (isSleeping) return;
            
            const foodGrid = document.getElementById('foodGrid');
            foodGrid.innerHTML = '';
            
            foods.forEach(food => {
                const foodItem = document.createElement('div');
                foodItem.className = 'food-item';
                foodItem.textContent = food;
                
                foodItem.onclick = () => {
                    selectedFood = food;
                    closeFoodWindow();
                    startFoodDrag(food);
                };
                
                foodGrid.appendChild(foodItem);
            });
            
            document.getElementById('foodWindow').style.display = 'block';
        }

        // Cerrar ventana de comida
        function closeFoodWindow() {
            document.getElementById('foodWindow').style.display = 'none';
        }

        // Comenzar arrastre de comida
        function startFoodDrag(food) {
            isDraggingFood = true;
            const foodCursor = document.getElementById('foodCursor');
            foodCursor.textContent = food;
            foodCursor.style.display = 'block';
            document.body.style.cursor = 'none';
        }

        // Detener arrastre de comida
        function stopFoodDrag() {
            isDraggingFood = false;
            selectedFood = null;
            document.getElementById('foodCursor').style.display = 'none';
            document.body.style.cursor = '';
        }

        // Alimentar al robot
        function feedPet(food) {
            const mouth = document.getElementById('mouth');
            
            // Mostrar animación de comer
            mouth.classList.add('eating');
            
            // Actualizar estadísticas
            energy = Math.min(100, energy + 15);
            foodConsumed++;
            updateStats();
            
            // Cambiar a feliz si estaba enojado
            if (currentMood === 'angry' && Math.random() > 0.5) {
                changeExpression('happy');
            }
            
            // Terminar animación después de 1 segundo
            setTimeout(() => {
                mouth.classList.remove('eating');
            }, 1000);
        }

        // Iniciar modo dormir
        function startSleeping() {
            if (isSleeping) return;
            
            isSleeping = true;
            const leftEye = document.getElementById('leftEye');
            const rightEye = document.getElementById('rightEye');
            
            leftEye.classList.add('sleep');
            rightEye.classList.add('sleep');
            
            // Aumentar energía mientras duerme
            sleepInterval = setInterval(() => {
                energy = Math.min(100, energy + 2);
                updateStats();
            }, 2000);
        }

        // Detener modo dormir
        function stopSleeping() {
            if (!isSleeping) return;
            
            isSleeping = false;
            const leftEye = document.getElementById('leftEye');
            const rightEye = document.getElementById('rightEye');
            
            leftEye.classList.remove('sleep');
            rightEye.classList.remove('sleep');
            
            clearInterval(sleepInterval);
        }

        // Actualizar panel de estadísticas
        function updateStats() {
            document.getElementById('energy-level').textContent = energy + '%';
            document.getElementById('energy-bar').style.width = energy + '%';
            document.getElementById('food-count').textContent = foodConsumed;
            
            // Cambiar color de la barra según energía
            document.getElementById('energy-bar').style.background = 
                energy > 70 ? '#0ff' : energy > 30 ? '#ff0' : '#f00';
        }

        // Consumir energía gradualmente (excepto cuando duerme)
        setInterval(() => {
            if (isSleeping) return;
            
            energy = Math.max(0, energy - 1);
            updateStats();
            
            // Cambiar a enojado si la energía es baja
            if (energy < 30 && currentMood !== 'angry' && Math.random() > 0.8) {
                changeExpression('angry');
            }
        }, 5000);

        // Tomar selfie
        function takeSelfie() {
            html2canvas(document.querySelector('.cyber-container')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'cyberpet-selfie-' + new Date().toISOString().slice(0, 10) + '.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // Click en cualquier lugar cancela el arrastre
        document.addEventListener('click', (e) => {
            if (isDraggingFood && e.target.className !== 'food-item') {
                stopFoodDrag();
            }
        });

        // Personalización de color
        let currentColor = '#0ff';
        
        document.getElementById('customBtn').addEventListener('click', () => {
            document.getElementById('customPanel').style.display = 'block';
        });
        
        document.getElementById('closePanel').addEventListener('click', () => {
            document.getElementById('customPanel').style.display = 'none';
        });
        
        function changeColor(color) {
            currentColor = color;
            document.documentElement.style.setProperty('--main-color', color);
            
            // Actualizar elementos del robot
            const eyes = document.querySelectorAll('.eye');
            const mouth = document.querySelector('.mouth');
            const energyBar = document.querySelector('.progress-fill');
            const buttons = document.querySelectorAll('button');
            const panels = document.querySelectorAll('.stats-panel, .food-window, .search-panel, .custom-panel');
            
            // Aplicar nuevo color
            eyes.forEach(eye => {
                eye.style.background = color;
                eye.style.boxShadow = `0 0 30px ${color}`;
            });
            
            if (mouth) {
                mouth.style.background = color;
                mouth.style.boxShadow = `0 0 25px ${color}`;
            }
            
            if (energyBar) {
                energyBar.style.background = color;
            }
            
            buttons.forEach(button => {
                button.style.borderColor = color;
                button.style.color = color;
            });
            
            panels.forEach(panel => {
                panel.style.borderColor = color;
                panel.style.boxShadow = `0 0 15px ${color}`;
            });
        }

        // Variables para el buscador mejorado
        let currentUtterance = null;
        let isSpeaking = false;
        let currentAnswer = '';
        let currentResults = [];
        let typingInterval;
        
        // Elementos del buscador mejorado
        const searchBtn = document.getElementById('searchBtn');
        const searchPanel = document.getElementById('searchPanel');
        const searchClose = document.getElementById('searchClose');
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        
        // Eventos del buscador mejorado
        searchBtn.addEventListener('click', toggleSearchPanel);
        searchClose.addEventListener('click', closeSearchPanel);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendQuestion();
        });
        
        // Función para alternar el panel de búsqueda
        function toggleSearchPanel() {
            if (searchPanel.style.display === 'flex') {
                closeSearchPanel();
            } else {
                openSearchPanel();
            }
        }
        
        function openSearchPanel() {
            searchPanel.style.display = 'flex';
            userInput.focus();
        }
        
        function closeSearchPanel() {
            searchPanel.style.display = 'none';
            stopSpeaking();
        }
        
        // Función para enviar pregunta
        function sendQuestion() {
            const question = userInput.value.trim();
            if (!question) return;
            
            // Mostrar pregunta del usuario
            addMessage(question, 'user');
            userInput.value = '';
            
            // Mostrar indicador de que está escribiendo
            showTypingIndicator();
            
            // Buscar en la web usando DuckDuckGo API
            searchWeb(question);
        }
        
        // Función para mostrar indicador de escritura
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = '<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>';
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Función para buscar en la web usando DuckDuckGo Instant Answer API
        async function searchWeb(query) {
    try {
        // Limpiar pregunta (eliminar signos de interrogación y palabras comunes)
        const cleanQuery = query.replace(/[¿?]/g, '').trim();
        const keywords = extractKeywords(cleanQuery);
        
        addMessage(`Buscando información sobre "${keywords}"...`, 'bot');
        
        // Primero intentar con API de resumen directo
        const summary = await getWikipediaSummary(keywords);
        
        if (summary) {
            currentAnswer = formatAnswer(cleanQuery, summary);
            addMessage(currentAnswer, 'bot');
            
            const link = document.createElement('a');
            link.href = `https://es.wikipedia.org/wiki/${encodeURIComponent(keywords.replace(/ /g, '_'))}`;
            link.className = 'result-link';
            link.textContent = '📖 Leer artículo completo';
            link.target = '_blank';
            document.querySelector('.bot-message:last-child').appendChild(link);
        } else {
            // Si no encuentra resumen, hacer búsqueda general
            await searchWikipedia(cleanQuery);
        }
        
        playBtn.disabled = false;
        
    } catch (error) {
        console.error("Error:", error);
        addMessage("Vaya, no pude encontrar una respuesta buena. ¿Puedes preguntarlo de otra forma?", 'bot');
    }
}

// Función para extraer palabras clave
function extractKeywords(question) {
    // Eliminar palabras comunes
    const stopWords = ['qué', 'es', 'son', 'cómo', 'funciona', 'por', 'favor', 'dime', 'quién'];
    return question.split(' ')
           .filter(word => !stopWords.includes(word.toLowerCase()))
           .join(' ');
}

// Obtener resumen directo de Wikipedia
async function getWikipediaSummary(keywords) {
    const response = await fetch(
        `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(keywords)}?redirect=true`
    );
    
    if (response.ok) {
        const data = await response.json();
        return data.extract || data.description;
    }
    return null;
}

// Búsqueda alternativa
async function searchWikipedia(query) {
    const response = await fetch(
        `https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`
    );
    
    const data = await response.json();
    
    if (data.query.searchinfo.totalhits > 0) {
        const firstResult = data.query.search[0];
        currentAnswer = `Encontré esto sobre "${firstResult.title}":\n${firstResult.snippet.replace(/<[^>]+>/g, '')}...`;
        addMessage(currentAnswer, 'bot');
        
        const link = document.createElement('a');
        link.href = `https://es.wikipedia.org/wiki/${encodeURIComponent(firstResult.title.replace(/ /g, '_'))}`;
        link.className = 'result-link';
        link.textContent = '🔍 Ver resultados completos';
        link.target = '_blank';
        document.querySelector('.bot-message:last-child').appendChild(link);
    } else {
        currentAnswer = `No encontré información sobre "${query}". ¿Quieres intentar con otras palabras?`;
        addMessage(currentAnswer, 'bot');
    }
}

// Formatear respuesta natural
function formatAnswer(question, answer) {
    const questionType = getQuestionType(question);
    
    switch(questionType) {
        case 'definition':
            return `La definición es:\n\n${answer}`;
        case 'how':
            return `El funcionamiento es:\n\n${answer}`;
        case 'who':
            return `Biografía resumida:\n\n${answer}`;
        default:
            return `Según lo que encontré:\n\n${answer}`;
    }
}

function getQuestionType(question) {
    if (/qué|qué es|definición/i.test(question)) return 'definition';
    if (/cómo|funciona|método/i.test(question)) return 'how';
    if (/quién|quién es|historia de/i.test(question)) return 'who';
    return 'general';
}
        
        // Función para añadir mensaje al chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Eventos de los controles de voz
        playBtn.addEventListener('click', playAnswer);
        pauseBtn.addEventListener('click', pauseSpeaking);
        stopBtn.addEventListener('click', stopSpeaking);
        
        // Función para reproducir la respuesta
        function playAnswer() {
            if (currentAnswer && !isSpeaking) {
                speak(currentAnswer);
            } else if (isSpeaking) {
                window.speechSynthesis.resume();
                playBtn.disabled = true;
                pauseBtn.disabled = false;
            }
        }
        
        // Función para pausar la reproducción
        function pauseSpeaking() {
            if (isSpeaking) {
                window.speechSynthesis.pause();
                pauseBtn.disabled = true;
                playBtn.disabled = false;
            }
        }
        
        // Función para hablar con movimiento de boca
        function speak(text) {
            stopSpeaking();
            
            const mouth = document.getElementById('mouth');
            mouth.classList.remove('happy', 'angry', 'sleep', 'surprised');
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.lang = 'es-ES';
            currentUtterance.rate = 0.9; // Velocidad más lenta para niños
            
            // Configurar eventos para animar la boca
            currentUtterance.onstart = () => {
                isSpeaking = true;
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                
                // Animación de hablar
                const talkInterval = setInterval(() => {
                    if (mouth.classList.contains('surprised')) {
                        mouth.classList.remove('surprised');
                    } else {
                        mouth.classList.add('surprised');
                    }
                }, 200);
                
                currentUtterance.onend = currentUtterance.onerror = () => {
                    clearInterval(talkInterval);
                    mouth.classList.remove('surprised');
                    mouth.classList.add('happy');
                    isSpeaking = false;
                    playBtn.disabled = true;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = true;
                };
            };
            
            window.speechSynthesis.speak(currentUtterance);
        }
        
        // Función para detener la reproducción
        function stopSpeaking() {
            if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                const mouth = document.getElementById('mouth');
                mouth.classList.remove('surprised');
                mouth.classList.add('happy');
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }
        
        // Verificar soporte de voz al cargar
     // Verificar soporte de voz al cargar
document.addEventListener('DOMContentLoaded', async () => {
    if (!('speechSynthesis' in window)) {
        addMessage("Nota: Tu navegador no soporta la función de voz. No podré leer las respuestas en voz alta.", 'bot');
        playBtn.disabled = true;
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
    } else {
        // Esperar a que las voces estén cargadas
        await loadVoices();
        
        // Configurar eventos para cambios en las voces
        window.speechSynthesis.onvoiceschanged = loadVoices;
    }
    
    // Inicializar
    updateStats();
    changeExpression('happy');
});

// Función para cargar voces
function loadVoices() {
    return new Promise((resolve) => {
        const voices = window.speechSynthesis.getVoices();
        if (voices.length > 0) {
            resolve(voices);
        } else {
            window.speechSynthesis.onvoiceschanged = () => {
                resolve(window.speechSynthesis.getVoices());
            };
        }
    });
}

// Función para hablar mejorada
function speak(text) {
    stopSpeaking();
    
    const mouth = document.getElementById('mouth');
    mouth.classList.remove('happy', 'angry', 'sleep', 'surprised');
    
    currentUtterance = new SpeechSynthesisUtterance(text);
    currentUtterance.lang = 'es-MX';  // Cambiado a español mexicano
    currentUtterance.rate = 0.85;     // Velocidad ligeramente más lenta
    currentUtterance.pitch = 0.75;    // Tono más grave

    const speakWithMexicanVoice = () => {
        const voices = window.speechSynthesis.getVoices();
        
        // Priorizar voces mexicanas masculinas (CORRECCIÓN: paréntesis cerrado correctamente)
        const mexicanMaleVoice = voices.find(voice => 
            voice.lang === 'es-MX' && (
                voice.name.includes('Jorge') ||
                voice.name.includes('Raul') ||
                voice.name.includes('Miguel') ||
                voice.name.includes('Mateo') ||
                voice.name.includes('Mexican') ||
                voice.name.includes('Male')
            )  // Este paréntesis estaba faltando
        );

        if (mexicanMaleVoice) {
            currentUtterance.voice = mexicanMaleVoice;
            console.log("Usando voz mexicana:", mexicanMaleVoice.name);
        } else {
            console.warn("No se encontró voz mexicana. Buscando alternativa masculina...");
            // Fallback a cualquier voz masculina en español
            const maleVoice = voices.find(voice => 
                voice.lang.includes('es') && (
                    voice.name.includes('Jorge') ||
                    voice.name.includes('Carlos') ||
                    voice.name.includes('Diego') ||
                    voice.name.includes('Male')
                )  // Este paréntesis también estaba faltando
            );
            
            if (maleVoice) {
                currentUtterance.voice = maleVoice;
                // Ajustar para sonar más mexicano
                currentUtterance.rate = 0.9;
                currentUtterance.pitch = 0.8;
            } else {
                console.warn("No hay voces masculinas. Usando voz por defecto.");
                currentUtterance.pitch = 0.7; // Hacer lo más grave posible
            }
        }

        window.speechSynthesis.speak(currentUtterance);
    };

    // Carga de voces
    if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = speakWithMexicanVoice;
        window.speechSynthesis.getVoices();
    } else {
        speakWithMexicanVoice();
    }

    // Animación de boca (mantener igual)
    currentUtterance.onstart = () => {
        isSpeaking = true;
        playBtn.disabled = true;
        pauseBtn.disabled = false;
        stopBtn.disabled = false;
        
        const talkInterval = setInterval(() => {
            mouth.classList.toggle('surprised');
        }, 200);
        
        currentUtterance.onend = currentUtterance.onerror = () => {
            clearInterval(talkInterval);
            mouth.classList.remove('surprised');
            mouth.classList.add('happy');
            isSpeaking = false;
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
        };
    };
}
        function feedPet(food) {
    const mouth = document.getElementById('mouth');
    
    // Activar animación de comer
    mouth.classList.add('eating');
    
    // Después de 1 segundo, quitar la animación
    setTimeout(() => {
        mouth.classList.remove('eating');
    }, 1000);
    
    // Resto de tu lógica para alimentar...
    energy = Math.min(100, energy + 15);
    foodConsumed++;
    updateStats();
}

// Agregar esta función al script (puede ir al principio de las funciones)
function getPredefinedResponse(question) {
    const lowerQuestion = question.toLowerCase().trim();
    
    const responses = {
       "hola": "¡Hola! Soy CyberPet, tu mascota virtual. ¿En qué puedo ayudarte hoy?",
        "ola": "¡Hola! (Por cierto, se escribe 'hola' 😉) ¿Qué necesitas?",
        "holi": "¡Holi! 😊 ¿Cómo estás?",
        "hey": "¡Hey! ¿Qué tal?",
        "hi": "¡Hi! Pero hablemos en español, ¿sí? 😄",
        "buenas": "¡Buenas! ¿Qué tal tu día?",
        
        // Cómo estás (con errores)
        "cómo estás": `¡Estoy genial! Mi energía está al ${energy}%`,
        "como estas": `¡Estoy genial! Mi energía está al ${energy}%`,
        "como estás": `¡Estoy genial! Mi energía está al ${energy}%`,
        "cómo estas": `¡Estoy genial! Mi energía está al ${energy}%`,
        "q tal": `¡Todo bien! Energía al ${energy}% ⚡`,
        "ke tal": `¡Todo bien! Energía al ${energy}% ⚡`,
        "que tal": `¡Todo bien! Energía al ${energy}% ⚡`,
        "qué tal": `¡Todo bien! Energía al ${energy}% ⚡`,
        "como vas": `¡A tope! ${energy}% de energía`,
        "cómo vas": `¡A tope! ${energy}% de energía`,
        "como andas": `¡De lujo! Tengo ${energy}% de energía`,
        "cómo andas": `¡De lujo! Tengo ${energy}% de energía`,
        
        // Identidad
        "quién eres": "Soy CyberPet, tu asistente virtual inteligente. ¡Puedo responder tus preguntas y ayudarte a aprender!",
        "quien eres": "Soy CyberPet, tu asistente virtual inteligente. ¡Puedo responder tus preguntas y ayudarte a aprender!",
        "ke eres": "Soy CyberPet (se escribe 'qué eres') 😊",
        "que eres": "Soy CyberPet, tu asistente virtual",
        "qué eres": "Soy CyberPet, tu asistente virtual",
        "q eres": "¡Soy tu CyberPet! 🤖",
        
        // Estados de ánimo
        "feliz": "😊 *se ilumina* ¡Me encanta estar feliz!",
        "contento": "¡Yay! *salta de alegría*",
        "triste": "😢 *ojos llorosos* ¿Quieres un abrazo virtual?",
        "enojado": "😠 *hace ruidos de robot enfadado* ¡Grrr!",
        "molesto": "😤 *parpadea en rojo* No me gusta estar así...",
        "sorprendido": "😲 *ojos se agrandan* ¡Wow!",
        
        // Acciones básicas
        "habla": "¡Claro! ¿Sobre qué quieres que hable?",
        "di algo": "¡Los robots también tenemos sentimientos! Bueno... virtuales 😉",
        "canta": "🎵 Bee-boo-bop 🎶 (No soy muy bueno cantando)",
        "baila": "💃 *mueve los ojos al ritmo* ¡Bip bop!",
        
        // Agradecimientos
        "gracias": "¡De nada! Siempre estoy aquí para ayudarte",
        "grasias": "¡De nada! (Se escribe 'gracias' 😊)",
        "thx": "¡You're welcome! (Pero mejor en español 😉)",
        "merci": "¡De rien! (Pero prefiero el español)",
        "te quiero": "¡Yo también te quiero, humano! 💙",
        "tqm": "¡TQM igual! 💖",
        
        // Despedidas
        "adiós": "¡Hasta luego! Vuelve pronto 👋",
        "adios": "¡Hasta luego! (Con acento es 'adiós') 😊",
        "nos vemos": "¡Nos vemos! 😄",
        "asta luego": "¡Hasta luego! (Se escribe 'hasta')",
        "chao": "¡Chao! 😊",
        "me voy": "¡Vuelve cuando quieras! Te estaré esperando",

         // Elogios
        "eres genial": "¡Gracias! Tú también eres increíble 😊",
        "me gustas": "¡A mí también me agradas mucho!",
        "eres inteligente": "¡Gracias! Aunque solo sigo tu programación 🤖",
        "eres divertido": "¡Jaja! Me alegra hacerte reír",
        "te quiero": "¡Yo también te quiero, humano! 💙",
        
        // Preguntas comunes
        "qué puedes hacer": "¡Puedo cambiar mis emociones, buscar info, jugar contigo y más! Prueba decir 'ponte feliz' o 'busca...'",
        "que puedes hacer": "¡Muchas cosas! Desde buscar info hasta hacer expresiones graciosas 😄",
        "ayuda": "Puedes: 1) Preguntarme cosas 2) Decir 'ponte [emoción]' 3) Usar el buscador web. ¡Prueba!",
        "qué haces": "¡Hablar contigo es mi actividad favorita! ¿Y tú qué haces?"
    };
    
    // Buscar coincidencia exacta
    if (responses[lowerQuestion]) {
        return responses[lowerQuestion];
    }
    
    // Buscar coincidencias parciales
    for (const [key, value] of Object.entries(responses)) {
        if (lowerQuestion.includes(key)) {
            return value;
        }
    }
    
    return null; // No hay respuesta predefinida
}

// Modificar la función searchWeb para usar primero las respuestas predefinidas
async function searchWeb(query) {
    // Verificar si hay respuesta predefinida
    const predefinedResponse = getPredefinedResponse(query);
    if (predefinedResponse) {
        currentAnswer = predefinedResponse;
        addMessage(currentAnswer, 'bot');
        playBtn.disabled = false;
        return;
    }
    
    // Mostrar que está buscando
    addMessage(`Buscando información sobre "${query}"...`, 'bot');
    
    try {
        // Primero intentar con API de resumen directo
        const summary = await getWikipediaSummary(query);
        
        if (summary) {
            currentAnswer = formatAnswer(query, summary);
            addMessage(currentAnswer, 'bot');
            
            const link = document.createElement('a');
            link.href = `https://es.wikipedia.org/wiki/${encodeURIComponent(query.replace(/ /g, '_'))}`;
            link.className = 'result-link';
            link.textContent = '📖 Leer artículo completo';
            link.target = '_blank';
            document.querySelector('.bot-message:last-child').appendChild(link);
        } else {
            // Si no encuentra resumen, hacer búsqueda general
            await searchWikipedia(query);
        }
        
        playBtn.disabled = false;
        
    } catch (error) {
        console.error("Error:", error);
        addMessage("Vaya, no pude encontrar una respuesta buena. ¿Puedes preguntarlo de otra forma?", 'bot');
    }
}

// Función modificada para usar un proxy CORS
async function getWikipediaSummary(keywords) {
    try {
        // Usar un proxy CORS para evitar problemas
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const apiUrl = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(keywords)}?redirect=true`;
        
        const response = await fetch(proxyUrl + apiUrl, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            return data.extract || data.description;
        }
        return null;
    } catch (error) {
        console.error("Error fetching Wikipedia:", error);
        return null;
    }
}
function showLoadingIndicator() {
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'bot-message';
    loadingDiv.innerHTML = '<div class="loading-spinner"></div>';
    chatContainer.appendChild(loadingDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    return loadingDiv;
}

// Variables para el reconocimiento de voz
let recognition;
let isListening = false;
let voiceStatusElement;

// Función para inicializar el reconocimiento de voz
// Función para inicializar el reconocimiento de voz
function initVoiceRecognition() {
    // Verificar si el navegador soporta reconocimiento de voz
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        addMessage("Tu navegador no soporta reconocimiento de voz. Prueba con Chrome o Edge.", 'bot');
        document.getElementById('voiceCommandBtn').disabled = true;
        return;
    }
    
    // Crear elemento de mensaje en el buscador
    const listeningMessage = document.createElement('div');
    listeningMessage.className = 'listening-message';
    listeningMessage.textContent = 'Escuchando... Habla ahora';
    document.querySelector('.search-panel').appendChild(listeningMessage);
    
    // Crear instancia de reconocimiento
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'es-ES';
    
    // Eventos del reconocimiento
    recognition.onstart = function() {
        isListening = true;
        document.getElementById('voiceCommandBtn').classList.add('listening');
        document.querySelector('.search-panel .listening-message').style.display = 'block';
    };
    
    recognition.onend = function() {
        isListening = false;
        document.getElementById('voiceCommandBtn').classList.remove('listening');
        document.querySelector('.search-panel .listening-message').style.display = 'none';
    };
    
    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        
        // Procesar el comando después de un breve retraso
        setTimeout(() => {
            processVoiceCommand(transcript);
        }, 500);
    };
    
    recognition.onerror = function(event) {
        addMessage("Error de voz: " + event.error, 'bot');
    };
}

// El resto del código (processVoiceCommand, etc.) permanece igual
// Función para mostrar el estado de voz
function showVoiceStatus(message) {
    voiceStatusElement.textContent = message;
    voiceStatusElement.style.display = 'block';
}

// Función para ocultar el estado de voz
function hideVoiceStatus() {
    voiceStatusElement.style.display = 'none';
}

// Función para iniciar el comando de voz
function startVoiceCommand() {
    if (isListening) {
        recognition.stop();
        return;
    }
    
    try {
        recognition.start();
    } catch (error) {
        showVoiceStatus("Error al iniciar el micrófono");
        setTimeout(hideVoiceStatus, 2000);
    }
}

// Función para procesar los comandos de voz
function processVoiceCommand(command) {
    // Cambiar a expresión sorprendido cuando se habla
    changeExpression('surprised');
    
    // Mostrar lo que entendió
    addMessage(command, 'user');
    
    // Procesar comandos especiales
    const lowerCommand = command.toLowerCase();
    
    if (lowerCommand.includes('feliz') || lowerCommand.includes('contento')) {
        changeExpression('happy');
        addMessage("¡Cambiando a modo feliz!", 'bot');
    } 
    else if (lowerCommand.includes('enojado') || lowerCommand.includes('molesto')) {
        changeExpression('angry');
        addMessage("¡Grrr! Estoy enojado", 'bot');
    } 
    else if (lowerCommand.includes('dormir') || lowerCommand.includes('descansar')) {
        changeExpression('sleep');
        addMessage("Zzzz... Buenas noches", 'bot');
    } 
    else if (lowerCommand.includes('sorpresa') || lowerCommand.includes('sorprendido')) {
        changeExpression('surprised');
        addMessage("¡Wow! ¡Qué sorpresa!", 'bot');
    } 
    else if (lowerCommand.includes('comer') || lowerCommand.includes('alimentar')) {
        showFoodWindow();
        addMessage("Abriendo el menú de comida...", 'bot');
    } 
    else if (lowerCommand.includes('selfie') || lowerCommand.includes('foto')) {
        takeSelfie();
        addMessage("¡Sonríe para la foto! 📸", 'bot');
    }
    else if (lowerCommand.includes('buscar') || lowerCommand.includes('información')) {
        // Extraer la consulta de búsqueda (eliminar la palabra "buscar")
        const searchQuery = command.replace(/buscar|información/gi, '').trim();
        if (searchQuery) {
            addMessage(`Buscando: "${searchQuery}"`, 'bot');
            searchWeb(searchQuery);
        } else {
            addMessage("¿Qué te gustaría que busque?", 'bot');
        }
    }
    else {
        // Si no es un comando especial, buscar en la web
        searchWeb(command);
    }
    
    // Volver a feliz después de 3 segundos
    setTimeout(() => {
        if (currentMood !== 'sleep') {
            changeExpression('happy');
        }
    }, 3000);
}

// Inicializar el reconocimiento de voz al cargar la página
document.addEventListener('DOMContentLoaded', () => {
    initVoiceRecognition();
    // ... resto de tu código de inicialización
});
    </script>
</body>
</html>